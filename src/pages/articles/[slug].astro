---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map(article => ({
    params: { slug: article.slug },
    props: { article }
  }));
}

const { article } = Astro.props;

// ðŸ”¥ THIS LINE WAS MISSING
const { Content } = await article.render();

const allArticles = await getCollection('articles');

const related = allArticles
  .filter(a =>
    a.data?.category &&
    article.data?.category &&
    a.data.category === article.data.category &&
    a.slug !== article.slug
  )
  .slice(0, 3);
---

<MainLayout title={article.data.title} description={article.data.description}>

<h1>{article.data.title}</h1>
<p style="color:#6b7280;">{article.data.description}</p>

<article>
  <Content />
</article>

<hr style="margin:40px 0;" />

<h3>Related Articles</h3>

{related.map(item => (
  <div class="card">
    <a href={`/articles/${item.slug}/`}>
      <h4>{item.data.title}</h4>
      <p style="color:#6b7280;">{item.data.description}</p>
    </a>
  </div>
))}

</MainLayout>
